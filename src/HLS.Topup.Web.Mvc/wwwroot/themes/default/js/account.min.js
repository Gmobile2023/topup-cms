function loginCallback(n,t){if(console.log(n),n.status==="PARTIALLY_AUTHENTICATED"){var i=n.code,r=n.state;GetToken(i,t)}else n.status==="NOT_AUTHENTICATED"?showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger"):n.status==="BAD_PARAMS"&&showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}function GetToken(n,t){var i="https://graph.accountkit.com/"+version+"/access_token?grant_type=authorization_code&code="+n+"&access_token=AA|"+facebookAppId+"|"+appSecrect;$.ajax({url:i,method:"GET",cache:!1,data:{},success:function(n){console.log("Get access token",n);n.id&&n.access_token?GetInfo(n.access_token,t):showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}})}function GetInfo(n,t){var i="https://graph.accountkit.com/"+version+"/me/?access_token="+n;$.ajax({url:i,method:"GET",cache:!1,data:{},success:function(n){console.log("Get account info",n);n.phone?verifyAccount(n.phone.national_number,userId,t):showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}})}function verifyAccount(n,t,i){$.ajax({url:urlVerify,method:"POST",cache:!1,data:{phone:n,userId:t},success:function(n){console.log("Verify account",n);n.status?i():showMessage("Lỗi xác thực",n.message,"danger")}})}function setToken(n){$.ajax({url:urlSetToken,method:"POST",cache:!1,data:{sessionToken:n},success:function(n){console.log("Set token",n);n.status?window.location.reload():showMessage("",n.message,"danger")}})}function smsLogin(n){AccountKit.login("PHONE",{countryCode:"+84"},n)}function emailLogin(){var n=document.getElementById("email").value;AccountKit.login("EMAIL",{emailAddress:n},loginCallback)}function fb_login(n){FB.login(function(t){t.authResponse?(access_token=t.authResponse.accessToken,user_id=t.authResponse.userID,FB.api("/me",{fields:"id,about,age_range,picture,email,first_name,gender,hometown,link,middle_name,name"},function(t){var i={id:t.id,desc:t.about,photo:"https://graph.facebook.com/"+t.id+"/picture?type=large",email:t.email,address:"",name:t.name,link:t.link,gender:t.gender};doLoginFB(n,i)})):console.log("User cancelled login or did not fully authorize.")},{scope:"public_profile,email,user_likes,user_hometown"})}function doLoginFB(n,t){var i=$("#login_facebook_btn");$.ajax({url:n,method:"POST",data:t,success:function(n){console.log(n);n.status?(urlSetToken=i.attr("data-settoken"),urlVerify=i.attr("data-verify"),userId=n.userId,loginToken=n.loginToken,n.isVerify?setToken(loginToken):showConfirm("Xác thực tài khoản",'Tài khoản của Quý khách chưa được xác thực, vui lòng chọn "YES" để bắt đầu xác thực bằng số điện thoại.',function(){smsLogin(function(n){loginCallback(n,function(){setToken(loginToken)})})})):showMessage("",n.message,n.type)}})}function showStoreProductModal(){var i=$(".product-item"),n=$("#storeProductModal"),t=!1;i.on("click",function(i){if(t)return!1;t=!0;i.preventDefault();var r=$(this).attr("data-url");$.ajax({url:r,method:"GET",data:{},success:function(t){t!==""&&t!==null&&(n.find("#storeProductModalContent").html(t),showModal(n))}}).done(function(){t=!1;changeGift(n)})})}function checkModalIsShow(n){return(n.data("bs.modal")||{}).isShown==!0}function changeGift(n){var i=$(".btn-dochangegift"),t=!1;i.on("click",function(i){if(i.preventDefault(),t)return!1;t=!0;var u=$(this).attr("data-productid"),f=$(this).attr("data-userid"),e=$(this).attr("data-success"),r=$(this).attr("data-fail"),o=apiPrefix+"store/changegift";n.find(".btn-changegift").attr("disabled","disabled");n.find(".btn-dochangegift").html('<i class="fa fa-spinner fa-spin"><\/i> Đang thực hiện ...');$.ajax({url:o,type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Token:"FD4C26708337FEAC9E113D44EBD227F6",DataToken:"123",AuthorizeToken:$.cookie("Token"),Flatform:"WEB"},xhrFields:{withCredentials:!0},data:{userId:f,storeProductId:u,flatform:"WEB"},success:function(t){t.status?showModalChangeGift(n,t,e):t.meta.hasOwnProperty("isVerify")?t.meta.isVerify?showModalChangeGift(n,t,r):(n.modal("hide"),showConfirm("Xác thực tài khoản",'Để đổi quà bằng Koin, Quý khách vui lòng chọn "YES" để bắt đầu xác thực tài khoản bằng số điện thoại.',function(){smsLogin(function(n){loginCallback(n,function(){window.location.reload()})})})):showModalChangeGift(n,t,r)}}).done(function(){t=!1;htmlAjaxLoad()}).fail(function(t){console.log(t.responseJSON);showModalChangeGift(n,t.responseJSON,r)})})}function showModalChangeGift(n,t,i){$.get(i,function(i){var r=$(i),u;t.status?(r.find("#cardCode").text(t.data.cards[0].code),r.find("#cardSeri").text(t.data.cards[0].serial)):r.find(".error-msg").text(t.message);n.find(".modal-body").html(r);u=checkModalIsShow(n);u||showModal(n)})}var facebookAppId="265452693905935",version="v1.2",appSecrect="2c5aca96431abdb85c9b679eae572ff0",userId=0,urlVerify="",urlSetToken="",loginToken="";AccountKit_OnInteractive=function(){AccountKit.init({appId:facebookAppId,state:md5(window.location.href+facebookAppId+appSecrect+version+userId),version:version,fbAppEventsEnabled:!0,status:!0})};$(function(){$("#do_login_form").on("submit",function(n){n.preventDefault();var i=$(this).serialize(),t=$(this);$.ajax({url:$(this).attr("action"),method:$(this).attr("method"),data:i,success:function(n){urlSetToken=t.attr("data-settoken");urlVerify=t.attr("data-verify");userId=n.userId;loginToken=n.loginToken;n.status?n.isVerify?setToken(loginToken):showConfirm("Xác thực tài khoản",'Tài khoản của Quý khách chưa được xác thực, vui lòng chọn "YES" để bắt đầu xác thực bằng số điện thoại.',function(){smsLogin(function(n){loginCallback(n,function(){setToken(loginToken)})})}):showMessage("",n.message,n.type);n.isReset&&$("#login_form").trigger("reset")}})});$("#login_facebook_btn").on("click",function(n){n.preventDefault();var t=$(this).attr("data-url");fb_login(t)})});$(function(){showStoreProductModal()})