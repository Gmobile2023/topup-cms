function loginCallback(t,o){if(console.log(t),"PARTIALLY_AUTHENTICATED"===t.status){var n=t.code;t.state;GetToken(n,o)}else"NOT_AUTHENTICATED"===t.status?showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger"):"BAD_PARAMS"===t.status&&showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}function GetToken(t,o){var n="https://graph.accountkit.com/"+version+"/access_token?grant_type=authorization_code&code="+t+"&access_token=AA|"+facebookAppId+"|"+appSecrect;$.ajax({url:n,method:"GET",cache:!1,data:{},success:function(t){console.log("Get access token",t),t.id&&t.access_token?GetInfo(t.access_token,o):showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}})}function GetInfo(t,o){var n="https://graph.accountkit.com/"+version+"/me/?access_token="+t;$.ajax({url:n,method:"GET",cache:!1,data:{},success:function(t){console.log("Get account info",t),t.phone?verifyAccount(t.phone.national_number,userId,o):showMessage("Xác thực tài khoản","Đã có lỗi xảy ra khi xác thực tài khoản, Quý khách vui lòng thực hiện lại hoặc liên hệ Hotline 0935.131.858","danger")}})}function verifyAccount(t,o,n){$.ajax({url:urlVerify,method:"POST",cache:!1,data:{phone:t,userId:o},success:function(t){console.log("Verify account",t),t.status?n():showMessage("Lỗi xác thực",t.message,"danger")}})}function setToken(t){$.ajax({url:urlSetToken,method:"POST",cache:!1,data:{sessionToken:t},success:function(t){console.log("Set token",t),t.status?window.location.reload():showMessage("",t.message,"danger")}})}function smsLogin(t){AccountKit.login("PHONE",{countryCode:"+84"},t)}function emailLogin(){var t=document.getElementById("email").value;AccountKit.login("EMAIL",{emailAddress:t},loginCallback)}function fb_login(t){FB.login(function(o){o.authResponse?(access_token=o.authResponse.accessToken,user_id=o.authResponse.userID,FB.api("/me",{fields:"id,about,age_range,picture,email,first_name,gender,hometown,link,middle_name,name"},function(o){var n={id:o.id,desc:o.about,photo:"https://graph.facebook.com/"+o.id+"/picture?type=large",email:o.email,address:"",name:o.name,link:o.link,gender:o.gender};doLoginFB(t,n)})):console.log("User cancelled login or did not fully authorize.")},{scope:"public_profile,email,user_likes,user_hometown"})}function doLoginFB(t,o){var n=$("#login_facebook_btn");$.ajax({url:t,method:"POST",data:o,success:function(t){console.log(t),t.status?(urlSetToken=n.attr("data-settoken"),urlVerify=n.attr("data-verify"),userId=t.userId,loginToken=t.loginToken,t.isVerify?setToken(loginToken):showConfirm("Xác thực tài khoản",'Tài khoản của Quý khách chưa được xác thực, vui lòng chọn "YES" để bắt đầu xác thực bằng số điện thoại.',function(){smsLogin(function(t){loginCallback(t,function(){setToken(loginToken)})})})):showMessage("",t.message,t.type)}})}function showStoreProductModal(){var t=$(".product-item"),o=$("#storeProductModal"),n=!1;t.on("click",function(t){if(n)return!1;n=!0,t.preventDefault();var e=$(this).attr("data-url");$.ajax({url:e,method:"GET",data:{},success:function(t){""!==t&&null!==t&&(o.find("#storeProductModalContent").html(t),showModal(o))}}).done(function(){n=!1,changeGift(o)})})}function checkModalIsShow(t){return 1==(t.data("bs.modal")||{}).isShown}function changeGift(t){var o=$(".btn-dochangegift"),n=!1;o.on("click",function(o){if(o.preventDefault(),n)return!1;n=!0;var e=$(this).attr("data-productid"),i=$(this).attr("data-userid"),a=$(this).attr("data-success"),c=$(this).attr("data-fail"),s=apiPrefix+"store/changegift";t.find(".btn-changegift").attr("disabled","disabled"),t.find(".btn-dochangegift").html('<i class="fa fa-spinner fa-spin"></i> Đang thực hiện ...'),$.ajax({url:s,type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Token:"FD4C26708337FEAC9E113D44EBD227F6",DataToken:"123",AuthorizeToken:$.cookie("Token"),Flatform:"WEB"},xhrFields:{withCredentials:!0},data:{userId:i,storeProductId:e,flatform:"WEB"},success:function(o){o.status?showModalChangeGift(t,o,a):o.meta.hasOwnProperty("isVerify")?o.meta.isVerify?showModalChangeGift(t,o,c):(t.modal("hide"),showConfirm("Xác thực tài khoản",'Để đổi quà bằng Koin, Quý khách vui lòng chọn "YES" để bắt đầu xác thực tài khoản bằng số điện thoại.',function(){smsLogin(function(t){loginCallback(t,function(){window.location.reload()})})})):showModalChangeGift(t,o,c)}}).done(function(){n=!1,htmlAjaxLoad()}).fail(function(o){console.log(o.responseJSON),showModalChangeGift(t,o.responseJSON,c)})})}function showModalChangeGift(t,o,n){$.get(n,function(n){var e=$(n);o.status?(e.find("#cardCode").text(o.data.cards[0].code),e.find("#cardSeri").text(o.data.cards[0].serial)):e.find(".error-msg").text(o.message),t.find(".modal-body").html(e),checkModalIsShow(t)||showModal(t)})}var facebookAppId="265452693905935",version="v1.2",appSecrect="2c5aca96431abdb85c9b679eae572ff0",userId=0,urlVerify="",urlSetToken="",loginToken="";AccountKit_OnInteractive=function(){AccountKit.init({appId:facebookAppId,state:md5(window.location.href+facebookAppId+appSecrect+version+userId),version:version,fbAppEventsEnabled:!0,status:!0})},$(function(){$("#do_login_form").on("submit",function(t){t.preventDefault();var o=$(this).serialize(),n=$(this);$.ajax({url:$(this).attr("action"),method:$(this).attr("method"),data:o,success:function(t){urlSetToken=n.attr("data-settoken"),urlVerify=n.attr("data-verify"),userId=t.userId,loginToken=t.loginToken,t.status?t.isVerify?setToken(loginToken):showConfirm("Xác thực tài khoản",'Tài khoản của Quý khách chưa được xác thực, vui lòng chọn "YES" để bắt đầu xác thực bằng số điện thoại.',function(){smsLogin(function(t){loginCallback(t,function(){setToken(loginToken)})})}):showMessage("",t.message,t.type),t.isReset&&$("#login_form").trigger("reset")}})}),$("#login_facebook_btn").on("click",function(t){t.preventDefault(),fb_login($(this).attr("data-url"))})}),$(function(){showStoreProductModal()});